<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>kCERT</title>
    
    <!-- Office.js -->
    <script type="text/javascript" src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
    
    <!-- Fabric UI CSS -->
    <link rel="stylesheet" href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-js/1.4.0/css/fabric.min.css">
    <link rel="stylesheet" href="https://static2.sharepointonline.com/files/fabric/office-ui-fabric-js/1.4.0/css/fabric.components.min.css">
</head>

<body class="ms-Fabric">
    <div class="ms-welcome">
        <header class="ms-welcome__header">
            <div class="branding">
                <img src="assets/KPMG_blue_logo.svg.png" alt="KPMG" class="brand-logo" />
                <div class="brand-text">
                    <h1>kCERT</h1>
                    <p>KPMG Comprehensive Excel Review Tool</p>
                </div>
            </div>
        </header>
        
        <main class="ms-welcome__main">
            <!-- Analysis Controls -->
            <section class="ms-welcome__features">
                <div class="ms-Grid">
                    <div class="ms-Grid-row">
                        <div class="ms-Grid-col ms-sm12">
                            <div class="ms-TextField">
                                <label class="ms-Label">Analysis Options</label>
                                <div class="analysis-options">
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="includeEmptyCells" checked>
                                        <label for="includeEmptyCells">Include empty cells in analysis</label>
                                    </div>
                                    <div class="checkbox-container">
                                        <input type="checkbox" id="groupSimilarFormulas" checked>
                                        <label for="groupSimilarFormulas">Group similar formulas</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="ms-Grid">
                    <div class="ms-Grid-row">
                        <div class="ms-Grid-col ms-sm12">
                            <button id="analyzeFormulas" class="ms-Button ms-Button--primary">
                                <span class="ms-Button-label">Analyze Workbook Formulas</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="map-controls">
                    <div class="map-actions">
                        <button id="generateMaps" class="ms-Button">
                            <span class="ms-Button-label">Generate Worksheet Maps</span>
                        </button>
                        <button id="refreshMapSheets" class="ms-Button map-refresh-button" type="button">
                            <span class="ms-Button-label">Refresh List</span>
                        </button>
                    </div>
                    <div class="map-selection">
                        <label class="map-selection-label">Select worksheets to include</label>
                        <div class="map-selection-actions">
                            <button id="selectAllMapSheets" class="ms-Button map-mini-button" type="button">
                                <span class="ms-Button-label">Select All</span>
                            </button>
                            <button id="clearAllMapSheets" class="ms-Button map-mini-button" type="button">
                                <span class="ms-Button-label">Deselect All</span>
                            </button>
                        </div>
                        <div id="mapSheetChecklist" class="map-sheet-list">
                            <div class="map-sheet-placeholder">Loading worksheets...</div>
                        </div>
                    </div>
                    <div id="mapRunSummary" class="map-run-summary" style="display: none;"></div>
                    <div class="map-legend" id="mapLegendPanel">
                        <h5>Worksheet Map Legend</h5>
                        <ul>
                            <li><span class="map-symbol map-symbol-f">F</span> Unique formula</li>
                            <li><span class="map-symbol map-symbol-left">&lt;</span> Copy from the left</li>
                            <li><span class="map-symbol map-symbol-up">^</span> Copy from above</li>
                            <li><span class="map-symbol map-symbol-both">+</span> Copy from both left and above</li>
                            <li><span class="map-symbol map-symbol-label">L</span> Label / descriptive text</li>
                            <li><span class="map-symbol map-symbol-input">N</span> Numeric input</li>
                            <li><span class="map-symbol map-symbol-array">A</span> Array formula spill</li>
                        </ul>
                        <p class="map-legend-note">Maps highlight copy direction breaks and blank cells within copy runs in the task pane summary after generation.</p>
                    </div>
                </div>
            </section>

            <!-- Results Section -->
            <section id="resultsSection" class="results-section" style="display: none;">
                <h3 class="ms-fontSize-l ms-fontWeight-semibold">Analysis Results</h3>

                <!-- Workbook Overview -->
                <h4 class="section-title">Workbook Overview</h4>
                <p class="section-help">High-level statistics for the entire workbook. Use this to gauge overall scale, duplication, and potential risk hot-spots before diving into individual sheets.</p>

                <!-- Summary Card -->
                <div id="summaryCard" class="summary-card ms-bgColor-neutralLighter">
                    <div class="ms-Grid">
                        <div class="ms-Grid-row">
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="totalWorksheets">0</span>
                                    <span class="stat-label">Worksheets</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="totalFormulas">0</span>
                                    <span class="stat-label">Total Formulas</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="uniqueFormulas">0</span>
                                    <span class="stat-label">Unique Formulas</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="totalHardCodedValues">0</span>
                                    <span class="stat-label">Hard-coded Values</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Cell Count Analysis -->
                <div id="cellCountAnalysis" class="analysis-section">
                    <h4 class="ms-fontSize-m ms-fontWeight-semibold">Cell Count Analysis</h4>
                    <p class="section-help">Breakdown of cells across the entire workbook. “Cells with Formulas” and “Cells with Values” may overlap on different sheets; “Empty Cells” is calculated as total minus formulas minus values.</p>
                    <div class="ms-Grid">
                        <div class="ms-Grid-row">
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="totalCells">0</span>
                                    <span class="stat-label">Total Cells</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="cellsWithFormulas">0</span>
                                    <span class="stat-label">Cells with Formulas</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="cellsWithValues">0</span>
                                    <span class="stat-label">Cells with Values</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm3">
                                <div class="stat-item">
                                    <span class="stat-number" id="emptyCells">0</span>
                                    <span class="stat-label">Empty Cells</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hard-coded Values Analysis -->
                <div id="hardCodedValuesAnalysis" class="analysis-section">
                    <h4 class="ms-fontSize-m ms-fontWeight-semibold">Hard-coded Values Analysis</h4>
                    <p class="section-help">Counts of likely hard-coded constants detected within formulas across the workbook. Severity reflects confidence: High (very likely an issue), Medium (possible), Low (informational). Review the list below for context and suggested fixes.</p>
                    <div class="ms-Grid">
                        <div class="ms-Grid-row">
                            <div class="ms-Grid-col ms-sm4">
                                <div class="stat-item high-confidence">
                                    <span class="stat-number" id="highConfidenceValues">0</span>
                                    <span class="stat-label">High Confidence</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm4">
                                <div class="stat-item medium-confidence">
                                    <span class="stat-number" id="mediumConfidenceValues">0</span>
                                    <span class="stat-label">Medium Confidence</span>
                                </div>
                            </div>
                            <div class="ms-Grid-col ms-sm4">
                                <div class="stat-item low-confidence">
                                    <span class="stat-number" id="lowConfidenceValues">0</span>
                                    <span class="stat-label">Low Confidence</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="hardCodedValuesList" class="hard-coded-values-list">
                        <!-- Dynamic content will be inserted here -->
                    </div>
                </div>

                <!-- Worksheet Details -->
                <h4 class="section-title" style="margin-top:28px;">Worksheet Analyses</h4>
                <p class="section-help">Each card summarizes one worksheet: analysis mode, formula counts, complexity, total cells, and detected hard-codes. Unique formulas are displayed in normalized form (e.g., <code>&lt;REL&gt;</code> for relative references, <code>&lt;ABS&gt;</code> for absolute references, <code>&lt;RANGE&gt;</code> for ranges) to group structurally similar formulas.</p>
                <div id="worksheetDetails" class="worksheet-details">
                    <!-- Dynamic content will be inserted here -->
                </div>

                <!-- Export Options -->
                <div class="export-options">
                    <button id="exportResults" class="ms-Button">
                        <span class="ms-Button-label">Export Analysis Report</span>
                    </button>
                    <button id="generateAuditTrail" class="ms-Button">
                        <span class="ms-Button-label">Generate Audit Trail</span>
                    </button>
                </div>
            </section>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="loading-indicator" style="display: none;">
                <div class="ms-Spinner ms-Spinner--large">
                    <div class="ms-Spinner-circle"></div>
                    <div class="ms-Spinner-label">Analyzing formulas...</div>
                </div>
            </div>

            <!-- Status Messages -->
            <div id="statusMessages" class="status-messages"></div>
        </main>
    </div>
</body>
</html> 
